当个好管家
========

统计磁盘使用情况  
计算命令的执行时间   
登录用户、启动日志及启动故障的相关信息  
列出1小时内占用CPU最多的10个进程  
用watch监视命令输出  
记录文件及目录访问  
用logrotate管理日志文件  
用syslog记录日志  
通过监视用户登录找出入侵者  
监视远程磁盘的健康情况  
找出系统中用户的活动时段  
电源使用的测量与优化   
监视磁盘活动   
检查磁盘及文件系统错误  

#### 统计磁盘使用情况  

df是disk free的缩写，du是disk usage的缩写  

du  
-a  递归地输出指定目录或多个目录中所有文件的统计结果  
-h  采用这种更友好的格式进行打印  
-c  以输出作为命令参数的所有文件和目录的磁盘使用情况  
-s  只输出合计数据  
-b  -k  -m  -B  以字节，KB，MB，块为单位  
--exclude  排除部分文件  
--exclude-from EXCLUDE.txt DIRECTORY  #EXCLUDE.txt包含了需要排除的文件列表  
--max-depth  指定du应该遍历的目录层次的最大深度  

找出指定目录中最大的10个文件  

包含目录：
```
 du -ak SOURCE_DIR | sort -nrk 1 | head -n 10  
```

不包含目录
```
find . -type f -exec du -k {} \; | sort -nrk 1 | head -n 10
```

#### 计算命令的执行时间  

```
time COMMAND  
```

有内建的命令time和功能更多的/usr/bin/time  

/usr/bin/time -o output.txt COMMAND  
/usr/bin/time -a -o output.txt COMMAND  要将命令执行时间添加到文件而不影响其原有内容
-f  格式字符串来格式化时间输出  

  real: %e  挂钟时间（wall clock time），命令从开始执行到结束的时间  
  user: %U  进程花费在用户模式（内核之外）中的CPU时间，唯一真正用于执行进程所花费的时间  
  sys: %S   进程花费在内核中的CPU时间，在内核中执行系统调用所使用的时间  与“user时间”类似，这也是真正由进程使用的CPU时间  

```
/usr/bin/time -f "Time: %U" -a -o timing.log uname 
```

格式化输出生成后被写入标准输出，命令的执行时间信息被写入标准错误。我们可以用重定向操作符（>）对格式化输出重定向，用错误重定向操作符（2>）对时间信息重定向  

```
/usr/bin/time -f "Time: %U" uname> command_output.txt 2>time.log 
```

使用参数%Z显示系统页面大小  
```
/usr/bin/time -f "Page size: %Z bytes" ls> /dev/null 
```

%C  进行计时的命令名称以及命令行参数  
%D  进程非共享数据区域的大小，以KB为单位  
%E  进程使用的real时间（挂钟时间），显示格式为[小时:]分钟:秒  
%x  命令的退出状态  
%k  进程接收到的信号数量  
%W  进程被交换出主存的次数  
%Z  系统的页面大小。这是一个系统常量，但在不同的系统中，这个常量值也不同  
%P  进程所获得的CPU时间百分比。这个值等于user+system时间除以总运行时间。结果以百分比形式显示  
%K  进程的平均总（data+stack+text）内存使用量，以KB为单位  
%w  进程主动进行上下文切换的次数，例如等待I/O操作完成  
%c  进程被迫进行上下文切换的次数（由于时间片到期）  


#### 登录用户、启动日志及启动故障的相关信息  

who  获取当前登录用户的相关信息  
  显示出登录名、用户所使用的TTY、登录时间以及登录用户的远程主机名  

w  获得有关登录用户更详细的信息  

当前时间  系统运行时间  当前登录的用户数量  过去的1、5、15分钟内的系统平均负载
USER    登录名    
TTY  
FROM    远程主机  
LOGIN@  登录时间  
IDLE    空闲时间  
JCPU    自该用户登录后所使用的总CPU时间  
PCPU    当前运行进程所使用的CPU时间
WHAT    进程所对应的命令行


users   列出当前登录主机的用户列表  

排除同一个用户的伪终端
```
users | tr ' ' '\n' | sort | uniq 
```

uptime  查看系统已经加电运行了多长时间

提取运行时间  
```
uptime | grep -Po '\d{2}\:\d{2}\:\d{2}' 
```
利用了grep和perl风格的正则表达式来提取由冒号分隔的3组两位数字  

last  获取上一次启动以及用户登录会话的信息  
last命令以日志文件/var/log/wtmp作为输入日志数据  
相当于 last -f /var/log/wtmp  

last USER    获取单个用户登录会话的信息
last reboot  获取重启会话（reboot session）信息  
lastb        获取失败的用户登录会话信息

#### 列出1小时内占用CPU最多的10个进程  

参考  pcpu_usage.sh  

ps -eo comm,pcpu  comm表示命令名（command name），pcpu表示CPU使用率  
tail -n +2用来将 ps 输出中的头部和 COMMAND %CPU剥除  
cpu_usage.$$ 中的 $$ 表示当前脚本的进程 ID  

#### 用watch监视命令输出  


#### 记录文件及目录访问  


#### 用logrotate管理日志文件  


#### 用syslog记录日志  


#### 通过监视用户登录找出入侵者  


#### 监视远程磁盘的健康情况  


#### 找出系统中用户的活动时段  


#### 电源使用的测量与优化   


#### 监视磁盘活动   


#### 检查磁盘及文件系统错误

